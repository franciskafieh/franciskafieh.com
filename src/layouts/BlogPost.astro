---
import Sidebar from "../components/Sidebar.astro";
import Page from "./Page.astro";
import "../lib/prism-material-palenight.css";

export interface Props {
  readTime: string;
  title: string;
  description: string;
  tags: string[];
}

const { readTime, title, description, tags } = Astro.props.frontmatter;

const { headings } = Astro.props;
---

<Page title={title} description={description}>
  <article class="prose w-full lg:w-8/12 max-w-none">
    <div class="text-center">
      <h1 class="text-3xl font-black text-accent">{title}</h1>
      <p>{readTime} | {tags ? tags.join(", ") : ""}</p>
    </div>
    <slot />
  </article>
  <Sidebar headings={headings} />
  <script
    src="https://giscus.app/client.js"
    data-repo="franciskafieh/franciskafieh.com"
    data-repo-id="R_kgDOHz-asA"
    data-category="comments"
    data-category-id="DIC_kwDOHz-asM4CRR_S"
    data-mapping="pathname"
    data-strict="1"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="dark"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async
  ></script>
</Page>

<script defer>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const getOverviewClassListById = (id) =>
          document.querySelector(`#overview > ul > li > a[href="#${id}"]`)
            .classList;

        if (entry.isIntersecting) {
          getOverviewClassListById(entry.target.children[0].id).add(
            "!text-accent"
          );
        } else {
          getOverviewClassListById(entry.target.children[0].id).remove(
            "!text-accent"
          );
        }
      });
    },
    { rootMargin: "-200px 0% -66% 0%" }
  );

  const sections = document.querySelectorAll("article section");

  sections.forEach((section) => observer.observe(section));
</script>
